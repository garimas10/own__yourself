<!DOCTYPE html>
<html lang="en">

<head>
  <!-- Required meta tags -->
  <meta charset="utf-8" />
  <meta http-equiv="cache-control" content="no-cache" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="-1" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Bootstrap CSS -->
  <link rel="stylesheet" href="css/pageTrans.css" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-eOJMYsd53ii+scO/bJGFsiCZc+5NDVN2yr8+0RDqr0Ql0h+rP48ckxlpbzKgwra6" crossorigin="anonymous" />
  <link rel="stylesheet" href="css/custom.css" />
  <link rel="preconnect" href="https://fonts.gstatic.com" />
  <link href="https://fonts.googleapis.com/css2?family=Merriweather+Sans:ital,wght@0,600;1,300;1,400;1,600&display=swap"
    rel="stylesheet" />
  <title>Statistics</title>
  <style type="text/css">
    .dragon {
      margin-top: 150px;
      margin-right: 80px;
    }
  </style>
</head>

<body>
  <div class="transition-container from-left">
    <span class="tile"></span>
    <span class="tile"></span>
    <span class="tile"></span>
    <span class="tile"></span>
    <span class="tile"></span>
    <span class="tile"></span>
    <span class="tile"></span>
    <span class="tile"></span>
    <span class="tile"></span>
  </div>

  <div class="transition-container from-top">
    <span class="tile"></span>
    <span class="tile"></span>
    <span class="tile"></span>
    <span class="tile"></span>
    <span class="tile"></span>
    <span class="tile"></span>
    <span class="tile"></span>
    <span class="tile"></span>
    <span class="tile"></span>
  </div>

  <nav style="height: 200px; font-size: x-large" class="navbar navbar-expand-lg navbar-light bg-light">
    <div class="container">
      <a class="navbar-brand" href="index.html"><img src="pics/logo.png" class="logo-main" alt="" width="200px"
          height="150px" /></a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbars-rs-food"
        aria-controls="navbars-rs-food" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbars-rs-food">
        <ul class="navbar-nav me-auto mb-2 mb-lg-0">
          <li class="nav-item">
            <a class="nav-link" aria-current="page" href="index.html">Home</a>
          </li>
          <li class="nav-item health-nav login-nav">
            <a class="nav-link" href="health.html">Health</a>
          </li>
          <li class="nav-item sports-nav">
            <a class="nav-link" href="sports.html">Sports</a>
          </li>
          <li class="nav-item meditation-nav">
            <a class="nav-link" href="med.html">Meditation</a>
          </li>
          <li class="nav-item about-nav">
            <a class="nav-link" href="about.html">About</a>
          </li>
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle active bg-warning" href="#" id="navbarDropdown" role="button"
              data-bs-toggle="dropdown" aria-expanded="false">
              Extra
            </a>
            <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
              <li>
                <a class="dropdown-item login-nav" href="stats.html">Statistics</a>
              </li>
              <li><a class="dropdown-item" href="games.html">Games</a></li>
              <li>
                <hr class="dropdown-divider" />
              </li>
              <li>
                <a class="dropdown-item login-nav" href="fb.html">Feedback</a>
              </li>
            </ul>
          </li>
        </ul>
        <form class="d-flex logout-form">
          <button class="btn btn-outline-success" id="logout-btn" type="submit">
            Logout
          </button>
        </form>
      </div>
    </div>
  </nav>
  <!--Nav bar end-->

  <div class="all-page-title page-stats">
    <div class="container text-center">
      <div class="row">
        <div class="col-lg-12">
          <h1>STATISTICS</h1>
        </div>
      </div>
    </div>
  </div>

  <!--Title end-->

  <div style="
        background-repeat: no-repeat;
        background-image: url('pics/stats-bg.jpg');
        background-attachment: fixed;
      ">
    <br /><br />
    <div class="row row-cols-2">
      <div class="col">
        <div class="m-5">
          <img src="pics/infographic.png" alt="..." style="display: block" height="150px" />
          <br />
          <br />
          <h1 style="font-family: 'Merriweather Sans'" class="">
            LET'S TRACK YOUR PROGRESS
          </h1>
          <form id="submit-calories">
            <div class="">
              <label style="font-size: x-large">Enter day number:</label>
              &ensp; &ensp; &ensp; &emsp; &emsp;
              <input type="number" id="day" min="0" max="" />
            </div>
            <br />
            <div class="">
              <label style="font-size: x-large">Enter calorie intake:</label>
              &ensp; &ensp; &ensp; &ensp; &ensp;
              <input type="number" id="calories" />
            </div>
            <br /><br />
            <div>
              <button style="font-size: x-large" class="bg-warning">
                TRACK PROGRESS
              </button>
              <br /><br /><br />
            </div>
          </form>
        </div>
      </div>
      <div class="col">
        <!-- Activity graph here -->
        <div class="dragon">
          <canvas id="myChart" width="1000" height="600"></canvas>
        </div>
      </div>
    </div>
  </div>

  <br /><br /><br />

  <!--Contact info-->

  <!-- Start Footer -->
  <footer class="footer-area bg-f">
    <div class="contact-imfo-box">
      <div class="container" style="background-color: #f0ad4e; color: white; border-radius: 20px">
        <div class="row">
          <div class="col-md-4">
            <div class="overflow-hidden">
              <h4>
                <i class="bi bi-telephone-fill" style="font-size: 1.05rem"></i>&nbsp;Phone
              </h4>
              <p class="lead" style="color: white">
                &nbsp;&nbsp;&nbsp;+91 87600 00678
              </p>
            </div>
          </div>

          <div class="col-md-4">
            <div class="overflow-hidden">
              <h4>
                <i class="bi bi-envelope-fill" style="font-size: 1.05rem"></i>&nbsp;Email
              </h4>
              <p class="lead" style="color: white">
                &nbsp;&nbsp;&nbsp;&nbsp;ownyourself@gmail.com
              </p>
            </div>
          </div>
          <div class="col-md-4">
            <div class="overflow-hidden">
              <h4>
                <i class="bi bi-globe2" style="font-size: 1.05rem"></i>&nbsp;Location
              </h4>
              <p class="lead" style="color: white">
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Jaipur
              </p>
            </div>
          </div>
        </div>
      </div>
    </div>
    <br />
    <div class="container">
      <div class="row">
        <div class="col-lg-5 col-md-6">
          <h3>About Us</h3>
          <p>
            Own Yourself is a website that offers credible information
            to help make yourself healthy and wise. It serves as a gateway to
            reliable information on sports, physical activity, yoga and
            meditation for consumers.
          </p>
        </div>
        <div class="col-lg-3 col-md-6">
          <h3>Subscribe</h3>
          <div class="subscribe_form">
            <form class="subscribe_form">
              <input name="EMAIL" id="subs-email" class="form_input" placeholder="Email Address..." type="email" />
              <button type="submit" class="submit mt-2" style="
                    background-color: #f0ad4e;
                    color: white;
                    border-radius: 20px;
                  ">
                SUBSCRIBE
              </button>
              <div class="clearfix"></div>
            </form>
          </div>
        </div>
        <div class="col-lg-3 col-md-6">
          <h3>Contact information</h3>
          <p class="lead"><a href="#">+91 87600 00678</a></p>
          <p class="lead"><a href="#">+91 98008 98008</a></p>
          <p><a href="#"> ownyourself.com</a></p>
        </div>
      </div>
    </div>

    <div class="copyright">
      <div class="container">
        <div class="row">
          <div class="col-lg-12">
            <p class="company-name">
              All Rights Reserved. &copy; 2022
              <a href="index.html">Own Yourself</a>
            </p>
          </div>
        </div>
      </div>
    </div>
  </footer>
  <script src="https://www.gstatic.com/firebasejs/8.6.3/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.6.3/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.6.3/firebase-firestore.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@3.2.1/dist/chart.min.js"></script>
  <script>
    var firebaseConfig = {
      apiKey: "AIzaSyDX6goN8ygHPzhyuvXQJTg4mh1tjOd9N5s",
      authDomain: "mindatpeace-afb41.firebaseapp.com",
      projectId: "mindatpeace-afb41",
      storageBucket: "mindatpeace-afb41.appspot.com",
      messagingSenderId: "296042005411",
      appId: "1:296042005411:web:76990cdb00598e7c029016",
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();
    //   Auth state changes
    const calorieForm = document.querySelector("#submit-calories");
    const ctx = document.getElementById("myChart").getContext("2d");
    let myChart;

    // console.log("USERID", userID);
    const insertCalories = document.querySelector("#submit-calories");
    let day, calories;
    const Ready = () => {
      day = parseInt(insertCalories["day"].value);
      calories = insertCalories["calories"].value;
    };

    function getChart(dataChart) {
      console.log(dataChart.xLabels.length);
      console.log(dataChart.yLabels.length);
      myChart = new Chart(ctx, {
        type: "line",
        data: {
          labels: dataChart.xLabels,
          datasets: [{
            label: "Calories burned in the day",
            data: dataChart.yLabels,
            backgroundColor: "rgba(234, 234, 113, 0.75)",
            borderColor: "rgba(22, 20, 22, 0.75)",
            borderWidth: 2,
          }, ],
        },
        options: {
          scales: {
            x: {
              ticks: {
                color: "black", //x-axis numbering colour
              },
              grid: {
                borderColor: "red",
              },
            },
            y: {
              ticks: {
                color: "black", //Y-axis numbering colour
              },
              grid: {
                borderColor: "white",
              },
              beginAtZero: true,
            },
          },
          animations: {
            tension: {
              duration: 1000,
              easing: "easeInOutElastic",
              from: 0.5,
              to: 0,
              loop: true,
            },
          },
          plugins: {
            title: {
              display: true,
              text: "CALORIE TRACKER",
              color: "black",
              position: "bottom",
              padding: {
                top: 10,
                bottom: 30,
              },
            },
            legend: {
              labels: {
                color: "black", //set the label colour
                // This more specific font property overrides the global property
                font: {
                  size: 13,
                },
              },
            },
          },
        },
      });
      myChart.update();
      console.log(dataChart.xLabels.length);
      console.log(dataChart.yLabels.length);
    }

    function getData(user) {
      const xLabels = [];
      const yLabels = [];
      const masterXY = [];
      console.log(user.uid);
      return new Promise((resolve, reject) => {
        db.collection(user.uid)
          .doc("CalorieTracker")
          .collection("Calories")
          .onSnapshot(
            (snapshot) => {
              let obj = snapshot.docs;
              obj.forEach((x) => {
                masterXY.push([parseInt(x.data().Day), x.data().Calories]);
              });
              // Sort cause after the 10th day, it starts messing up,
              // so parseInt and sort.
              masterXY.sort((a, b) => {
                // console.log("first=", a, " Second=", b);
                return a[0] - b[0];
              });
              console.log(masterXY);
              masterXY.forEach((ele) => {
                xLabels.push(ele[0]);
                yLabels.push(ele[1]);
              });
              resolve({
                xLabels,
                yLabels
              });
            },
            (err) => {
              console.log(err);
            }
          );
      });
    }
    auth.onAuthStateChanged((user) => {
      setupUI(user);
      // Display the chart when the site loads
      getData(user).then(getChart);
      if (user) {
        console.log("User logged in:", user);
        insertCalories.addEventListener("submit", (e) => {
          e.preventDefault();
          Ready();
          db.collection(user.uid)
            .doc("CalorieTracker")
            .collection("Calories")
            .doc(day + "")
            .set({
              Day: day,
              Calories: calories,
            })
            .then(() => {
              // Destroy and recreate the chart
              myChart.destroy();
              getData(user).then(getChart);
            });
        });
      } else {
        console.log("User not logged in, Signed Out");
      }
    });

    //   LogOUT
    const logout = document.querySelector("#logout-btn");
    logout.addEventListener("click", (e) => {
      e.preventDefault();
      auth.signOut();
      window.location = "index.html";
    });
  </script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-gtEjrD/SeCtmISkJkNUaaKMoLD0//ElJ19smozuHV6z3Iehds+3Ulb9Bn9Plx0x4" crossorigin="anonymous">
  </script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.6.1/gsap.min.js"></script>

  <!-- <script src="js/firebase.js"></script> -->
  <script src="js/index.js"></script>
  <script src="js/mainGSAP2.js"></script>

  <!-- <script src="js/gsapStyle.js"></script> -->
</body>

</html>